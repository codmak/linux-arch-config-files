#!/bin/sh
# ~/.xinitrc
# Description : Minimal, declarative X11 session initializer
# Author      : codmak
# Version     : 1.0
# Date        : 2025-08-04

# ------------------------------
# Environment
# ------------------------------

export TERM=st
export BROWSER=librewolf

# ------------------------------
# Xresources and keymap
# ------------------------------

xrdb_merge_if_exists() {
  [ -f "$1" ] && xrdb -merge "$1"
}

xmodmap_if_exists() {
  [ -f "$1" ] && xmodmap "$1"
}

xrdb_merge_if_exists /etc/X11/xinit/.Xresources
xrdb_merge_if_exists "$HOME/.Xresources"

xmodmap_if_exists /etc/X11/xinit/.Xmodmap
xmodmap_if_exists "$HOME/.Xmodmap"

# ------------------------------
# System startup hooks
# ------------------------------

if [ -d /etc/X11/xinit/xinitrc.d ]; then
  for script in /etc/X11/xinit/xinitrc.d/*.sh; do
    [ -x "$script" ] && . "$script"
  done
fi

# ------------------------------
# Launch window manager
# ------------------------------

exec_i3_or_fail() {
  command -v i3 >/dev/null && exec i3
  printf "Error: i3 not found.\n" >&2
  exit 1
}

exec_i3_or_fail
